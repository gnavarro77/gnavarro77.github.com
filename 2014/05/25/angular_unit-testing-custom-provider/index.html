<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog">
<meta name="author" content="Gilles Navarro">

<title>Angularjs, Unit Testing Custom Provider</title> 

<link rel="stylesheet"
	href="/assets/bower_components/bootstrap-css/css/bootstrap.css">
<link rel="stylesheet"
	href="/assets/bower_components/bootstrap-css/css/bootstrap-theme.css">
<link rel="stylesheet" href="/assets/css/solarized.css">
<link rel="stylesheet" href="/assets/theme/hellish-simplicity/style.css">

<script type="text/javascript"
		src="/assets/bower_components/jquery/dist/jquery.min.js"></script>

</head>
<body>

	<header id="site-header" role="banner">
		<div class="hgroup">
			<h1>De choses et d'autres</h1>
			<h2></h2>
		</div>
	</header>

	<div id="main" class="site-main">
		<div id="content-area">
			<div id="site-content" role="main"><article class="post type-post status-publish format-standard hentry category-uncategorized tag-boat tag-lake">
	<header class="entry-header">
		<h1 class="entry-title">Angularjs, Unit Testing Custom Provider </h1>
	</header>
	<div class="date">
      <span>25 May 2014</span>
    </div>
	<div class="entry-content">
		<p>On one of my project i ran into the need of testing a custom provider and after a few online search i realized that it was not so trivial so i decided to share the solution i used in case it might help someone.</p>

<h2 id="where-it-all-started-from">Where it all started from!</h2>

<p>I had a service that eventually was meant to send a request. I managed to stick a default URI for the service <br />
to call but i wanted the user to be able to change that URI if he wanted to do so.</p>

<p>I ended up with a provider that look something like that</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">myApp</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myService&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="s1">&#39;/my/uri&#39;</span><span class="p">;</span>
   
   <span class="k">this</span><span class="p">.</span><span class="nx">setUri</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">uri</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
   <span class="p">};</span>

   <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
         <span class="nx">myMethod</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// do whatever i want with my uri variable</span>
         <span class="p">}</span>
      <span class="p">}</span>
   <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h2 id="how-it-ended-up">How it ended up!</h2>

<p>To test the configuration capabilities of my provider, i ended up with the following kind of test</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myService&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">myService</span><span class="p">;</span>
	
	<span class="c1">// Load the module of the &#39;myService&#39; service</span>
	<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myModule&#39;</span><span class="p">));</span>
	
	<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_myService_</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">myService</span> <span class="o">=</span> <span class="nx">_myService_</span><span class="p">;</span>
	<span class="p">}));</span>
	
	<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should...&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
		<span class="c1">// Up here the uri value used is the default one</span>
	<span class="p">})</span>
<span class="p">});</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myService&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">myService</span><span class="p">;</span>
	
	<span class="c1">// Load the module of the &#39;myService&#39; service and configure the &#39;myService&#39; service</span>
	<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myModule&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">myServiceProvider</span><span class="p">)</span> <span class="p">{</span>
       		<span class="nx">myServiceProvider</span><span class="p">.</span><span class="nx">setUri</span><span class="p">(</span><span class="s1">&#39;/my/new/uri&#39;</span><span class="p">);</span>
	<span class="p">}));</span>
	
	<span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_myService_</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">myService</span> <span class="o">=</span> <span class="nx">_myService_</span><span class="p">;</span>
	<span class="p">}));</span>	

	<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should...&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
		<span class="c1">// Up here the uri value used is the one defined throught the service provider</span>
	<span class="p">})</span>
	
<span class="p">});</span></code></pre></div>

<p>This solution is not perfect as it represents code duplication but what i like is <br />
the clear separation between the default service behavior and the specialized one <br />
as the two are encapsulated in their own <code>describe</code> function.</p>

	</div>
	<footer class="entry-meta">
		
	</footer>
</article></div>
			<div id="sidebar" role="complementary">
<!-- 				<aside> -->
<!-- 					<h1 class="widget-title">Recent Posts</h1> -->
<!-- 					<ul> -->
<!-- 						<li><a href="https://wp-themes.com/?p=19" -->
<!-- 							title="Look Worth A Thousand Words">Worth A Thousand Words</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=36" -->
<!-- 							title="Look Elements">Elements</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=14" -->
<!-- 							title="Look More Tags">More Tags</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=8" title="Look HTML">HTML</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=6" title="Look Links">Links</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=4" -->
<!-- 							title="Look Category Hierarchy">Category Hierarchy</a></li> -->
<!-- 						<li><a href="https://wp-themes.com/?p=1" -->
<!-- 							title="Look Hello world!">Hello world!</a></li> -->
<!-- 					</ul> -->
<!-- 				</aside> -->
				<aside>
					<h1 class="widget-title">Archives</h1>
<ul class="list-unstyled">


  
  
  
  
  
  
    <li>
    	<a href="/2014/09/index.html">September 2014</a>
    </li>
     
  

  
  
  
  
  
  
    <li>
    	<a href="/2014/06/index.html">June 2014</a>
    </li>
     
  

  
  
  
  
  
  

  
  
  
  
  
  

  
  
  
  
  
  
    <li>
    	<a href="/2014/05/index.html">May 2014</a>
    </li>
     
  

  
</ul>


				</aside>
			</div>
		</div>
	</div>


</body>
</html>

